---
title: P3. Gazebo
date: 2024-05-12 18:00:00 +0100
author: javier
toc: true
comments: true
pin: true
---

## Estructura del paquete

El nombre del paquete es my_robot_description. En este hay 2 launchers principales para el robot description, uno para el modelo con brazo y otro para el que no lo tiene, siendo este último el que se usa en la simulación. Al igual que hay 2 launcher para el robot_state también hay 2 modelos urdf distintos, uno con brazo y otro sin él.

Esto implica que para poder realizar la simulación se deben ejecutar en este orden y asegurándose que el comando anterior se ha lanzado correctamente:

```bash
ros2 launch my_robot_description robot_info_without_arm.launch.py
ros2 launch my_robot_description robot_gazebo.launch.py
ros2 launch my_robot_description robot_controllers.launch.py
ros2 run my_robot_description speed_movement
```

## Árbol de TF

### Con brazo

![Con brazo Tf Tree](/assets/img/p3/with_arm_tf.svg)

### Sin brazo

Con el controlador lanzado para las ruedas y el mundo:

![Sin brazo Tf Tree](/assets/img/p3/wthout_arm_tf.svg)

## Módelo en rviz

### Con brazo

![Con brazo Tf](/assets/img/p3/with_arm_tf1.png)

![Con brazo Tf](/assets/img/p3/with_arm_tf2.png)

### Sin brazo

![Sin brazo Tf](/assets/img/p3/without_arm_tf_0.png)

![Sin brazo Tf](/assets/img/p3/without_arm_tf_1.png)

Lanzando el controlador para las ruedas:

![Sin brazo Tf](/assets/img/p3/without_arm_tf_2.png)

![Sin brazo Tf](/assets/img/p3/without_arm_tf_3.png)

## Simulación

### Mundo: Floor

{% include embed/youtube.html id='cEdSwBhfwTY' %}

### Mundo: Sand

{% include embed/youtube.html id='vA-zoh35QDA' %}

## Rosbags

Se encuentran en los siguientes enlaces:

- [Floor](https://github.com/javizqh-urjc-practices/MySR-p3-gazebo/tree/master/assets/rosbags/floor)
- [Sand](https://github.com/javizqh-urjc-practices/MySR-p3-gazebo/tree/master/assets/rosbags/sand)

## Gráficas y explicación

- Comparativa de las velocidades de las ruedas en los dos escenarios
publicadas en joint_states

![Joint_states](/assets/img/p3/joint_states.png)

En ambos escenarios se observa que un par de ruedas obtiene una velocidad positiva mientras que el otro par tiene una velocidad negativa de la misma magnitud.
También se aprecia el momento de choque del robot con las caja, que ocurre en los puntos donde la velocidad sufre un pico hacia el centro, es decir, decrece.

Una diferencia importante que se aprecia es que en el mundo de la arena las ruedas tardan más en iniciar su movimiento, ya que al ser "arena" la inercia es mayor que con el suelo normal.

- Comparativa de la velocidad de las ruedas publicadas en joint_states. Y los
desplazamientos que el controlador cree hacer, publicados en el topic de la
odometría. Comparativa que se debe realizar entre los dos escenarios.

· Floor:
![Floor](/assets/img/p3/floor_odometry.png)
![Floor Mov](/assets/img/p3/floor_odom2.png)

En la primera gráfica se observa como el robot se desplaza en el eje x y también ligeramente sobre el eje y que se acentúa más al chocar contra el cubo.

En la segunda gráfica se ve que la velocidad verdadera a la que se mueve es de 3 m/s porque en el controlador estaba puesto un límite a esa velocidad, ya que si fuera a una velocidad mayor se saldría del mundo antes de acabar la simulación. También se aprecia que el descenso real de la velocidad al chocarse es casi imperceptible y no sufre una caida tan drástica como en la velocidad de las ruedas.

· Sand:
![Sand](/assets/img/p3/sand_odometry.png)
![Sand](/assets/img/p3/sand_odom2.png)

En la primera gráfica se observa como el robot se desplaza en el eje x y también ligeramente sobre el eje y que se acentúa más al chocar contra el cubo.

En la segunda gráfica se ve que la velocidad verdadera a la que se mueve es de 3 m/s porque en el controlador estaba puesto un límite a esa velocidad, ya que si fuera a una velocidad mayor se saldría del mundo antes de acabar la simulación. También se aprecia que el descenso real de la velocidad al chocarse es mayor que en el mundo anterior. Otro punto importante es el comienzo del movimiento, donde se ve que al estar en arena el movimiento tarda más en comenzar por las razones explicadas anteriormente.

- Comparativa de las aceleraciones ejercidas por el robot en cada mundo, siendo
de especial interés el momento en el cual choca con los cubos.

![Imu](/assets/img/p3/imu.png)

De normal la aceleración oscila en ambos mundos en el ámbito de -2.5 a 5, pero cuando ocurre el choque entre el robot y los cubos se observan picos en la aceleración que van desde los -60 m/s debido a la perdida de contacto con el suelo a los 10 m/s cuando vuelve a contactar con el suelo.

## Video explicativo
